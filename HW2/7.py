import csv
import numpy as np
import matplotlib.pyplot as plt

#average data points
def weighted_sum(X,h,data,t):
    count = 0
    tot = 0
    avg_t = 0
    h_index = 0
    data_fa = []
    t_fa = []
    for i in range(len(data)):
        tot += data[i]
        avg_t += t[i]
        count += 1
        if count == X:
            tot = tot*h[h_index]
            avg_t = avg_t/count
            data_fa.append(tot)
            t_fa.append(avg_t)
            h_index += 1
            tot = 0
            avg_t = 0
            count = 0
        elif i == len(data_a):
            tot = tot*h[h_index]
            avg_t = avg_t/count
            data_fa.append(tot)
            t_fa.append(avg_t)
            h_index += 1
            tot = 0
            avg_t = 0
            count = 0
    return data_fa,t_fa

#perform fft
def my_fft(data,t):
    Fs = len(t)/t[-1]
    Ts = 1.0/Fs
    ts = np.arange(0,t[-1],Ts)
    k = np.arange(len(data))
    T = len(data)/Fs
    frq = (k/T)[range(int(len(data)/2))]
    Y = (np.fft.fft(data)/len(data))[range(int(len(data)/2))]
    return frq,Y

def import_data(filename):
    t = []
    data = []
    with open(filename) as f:
        reader = csv.reader(f)
        for row in reader:
            t.append(float(row[0]))
            data.append(float(row[1]))
    return t,data

#import data
t_a,data_a = import_data('sigA.csv')
t_b,data_b = import_data('sigB.csv')
t_c,data_c = import_data('sigC.csv')
t_d,data_d = import_data('sigD.csv')

#filter coefficients
h_a = [
    -0.000000000000000001,
    0.000064393676763220,
    0.000271319801257537,
    0.000649073204382278,
    0.001235623050647806,
    0.002076637553675906,
    0.003222058252059904,
    0.004721452177155945,
    0.006618513253826244,
    0.008945196904421814,
    0.011716041834802050,
    0.014923251981835048,
    0.018533075973444006,
    0.022483932798082779,
    0.026686597480116862,
    0.031026590809771163,
    0.035368727580917296,
    0.039563585562856544,
    0.043455480385182557,
    0.046891386356592825,
    0.049730143962839937,
    0.051851251307310706,
    0.053162553912562159,
    0.053606224358990776,
    0.053162553912562159,
    0.051851251307310706,
    0.049730143962839930,
    0.046891386356592839,
    0.043455480385182564,
    0.039563585562856544,
    0.035368727580917296,
    0.031026590809771187,
    0.026686597480116866,
    0.022483932798082775,
    0.018533075973443999,
    0.014923251981835051,
    0.011716041834802057,
    0.008945196904421819,
    0.006618513253826253,
    0.004721452177155945,
    0.003222058252059902,
    0.002076637553675908,
    0.001235623050647806,
    0.000649073204382280,
    0.000271319801257541,
    0.000064393676763220,
    -0.000000000000000001,
]
h_b = [
    0.000000000000000000,
    -0.000000720860170916,
    -0.000002922026023300,
    -0.000006645442006556,
    -0.000011910067435400,
    -0.000018709228510322,
    -0.000027007399766794,
    -0.000036736428850418,
    -0.000047791239728572,
    -0.000060025070854593,
    -0.000073244325897368,
    -0.000087203134930557,
    -0.000101597742939378,
    -0.000116060859661942,
    -0.000130156119675172,
    -0.000143372813836725,
    -0.000155121062323613,
    -0.000164727605238994,
    -0.000171432388826331,
    -0.000174386123538883,
    -0.000172648984440316,
    -0.000165190614615539,
    -0.000150891578486668,
    -0.000128546394276369,
    -0.000096868253539958,
    -0.000054495510978232,
    0.000000000000000000,
    0.000068102800847834,
    0.000151341757935196,
    0.000251276270486603,
    0.000369480732828958,
    0.000507527382763517,
    0.000666967682969224,
    0.000849312416479448,
    0.001056010709785838,
    0.001288428227358375,
    0.001547824808701015,
    0.001835331842895296,
    0.002151929695376261,
    0.002498425516951251,
    0.002875431775397811,
    0.003283345855025347,
    0.003722331069105983,
    0.004192299423914947,
    0.004692896461208677,
    0.005223488488348066,
    0.005783152482084092,
    0.006370668923503328,
    0.006984517788117883,
    0.007622877877009221,
    0.008283629632814532,
    0.008964361538775322,
    0.009662380150716797,
    0.010374723761419955,
    0.011098179645160085,
    0.011829304778023334,
    0.012564449877808428,
    0.013299786556708930,
    0.014031337331383400,
    0.014755008189264406,
    0.015466623367804475,
    0.016161961965531206,
    0.016836795970945853,
    0.017486929268035419,
    0.018108237155980558,
    0.018696705905937267,
    0.019248471869855219,
    0.019759859655368021,
    0.020227418886936500,
    0.020647959086616246,
    0.021018582227914164,
    0.021336712542938167,
    0.021600123196066568,
    0.021806959476200694,
    0.021955758203751261,
    0.022045463097196568,
    0.022075435896610211,
    0.022045463097196568,
    0.021955758203751261,
    0.021806959476200694,
    0.021600123196066568,
    0.021336712542938167,
    0.021018582227914171,
    0.020647959086616246,
    0.020227418886936500,
    0.019759859655368021,
    0.019248471869855219,
    0.018696705905937274,
    0.018108237155980565,
    0.017486929268035415,
    0.016836795970945853,
    0.016161961965531210,
    0.015466623367804482,
    0.014755008189264413,
    0.014031337331383400,
    0.013299786556708935,
    0.012564449877808432,
    0.011829304778023334,
    0.011098179645160086,
    0.010374723761419954,
    0.009662380150716797,
    0.008964361538775329,
    0.008283629632814538,
    0.007622877877009223,
    0.006984517788117881,
    0.006370668923503327,
    0.005783152482084095,
    0.005223488488348070,
    0.004692896461208679,
    0.004192299423914948,
    0.003722331069105982,
    0.003283345855025347,
    0.002875431775397812,
    0.002498425516951254,
    0.002151929695376262,
    0.001835331842895295,
    0.001547824808701015,
    0.001288428227358376,
    0.001056010709785838,
    0.000849312416479448,
    0.000666967682969225,
    0.000507527382763517,
    0.000369480732828958,
    0.000251276270486603,
    0.000151341757935196,
    0.000068102800847834,
    0.000000000000000000,
    -0.000054495510978232,
    -0.000096868253539958,
    -0.000128546394276369,
    -0.000150891578486668,
    -0.000165190614615539,
    -0.000172648984440316,
    -0.000174386123538883,
    -0.000171432388826331,
    -0.000164727605238994,
    -0.000155121062323613,
    -0.000143372813836725,
    -0.000130156119675172,
    -0.000116060859661943,
    -0.000101597742939379,
    -0.000087203134930557,
    -0.000073244325897368,
    -0.000060025070854593,
    -0.000047791239728572,
    -0.000036736428850418,
    -0.000027007399766794,
    -0.000018709228510322,
    -0.000011910067435400,
    -0.000006645442006556,
    -0.000002922026023300,
    -0.000000720860170916,
    0.000000000000000000,
]
h_c = [
    0.000000000000000000,
    -0.000000733187507994,
    -0.000002514832169553,
    -0.000004663189391103,
    -0.000006411912043391,
    -0.000006894650075208,
    -0.000005128921027786,
    0.000000000000000000,
    0.000009754363726571,
    0.000025557561404639,
    0.000049005219802397,
    0.000081872943140811,
    0.000126119913694109,
    0.000183887634646637,
    0.000257493196406908,
    0.000349416569001100,
    0.000462281565774996,
    0.000598830284134460,
    0.000761891003573286,
    0.000954339705406193,
    0.001179055567694072,
    0.001438870977808257,
    0.001736516788789889,
    0.002074563718984522,
    0.002455360952379098,
    0.002880973134926539,
    0.003353117075610483,
    0.003873099546309844,
    0.004441757628542494,
    0.005059403075507749,
    0.005725772142930002,
    0.006439982291319788,
    0.007200497075605886,
    0.008005100416757878,
    0.008850881296018204,
    0.009734229728566586,
    0.010650844663521859,
    0.011595754225546215,
    0.012563348464977427,
    0.013547424523904094,
    0.014541243860821495,
    0.015537600912594417,
    0.016528902315624129,
    0.017507255564510497,
    0.018464565762032634,
    0.019392638914479399,
    0.020283290056267139,
    0.021128454351758700,
    0.021920299223858908,
    0.022651335501065052,
    0.023314525559019444,
    0.023903386460090124,
    0.024412086164923179,
    0.024835531002085399,
    0.025169442733675097,
    0.025410423743004226,
    0.025556009091159522,
    0.025604704437664948,
    0.025556009091159525,
    0.025410423743004226,
    0.025169442733675097,
    0.024835531002085399,
    0.024412086164923172,
    0.023903386460090128,
    0.023314525559019444,
    0.022651335501065056,
    0.021920299223858911,
    0.021128454351758696,
    0.020283290056267146,
    0.019392638914479399,
    0.018464565762032644,
    0.017507255564510504,
    0.016528902315624129,
    0.015537600912594422,
    0.014541243860821501,
    0.013547424523904100,
    0.012563348464977434,
    0.011595754225546215,
    0.010650844663521864,
    0.009734229728566589,
    0.008850881296018210,
    0.008005100416757878,
    0.007200497075605891,
    0.006439982291319788,
    0.005725772142930000,
    0.005059403075507749,
    0.004441757628542499,
    0.003873099546309850,
    0.003353117075610484,
    0.002880973134926539,
    0.002455360952379100,
    0.002074563718984522,
    0.001736516788789891,
    0.001438870977808259,
    0.001179055567694071,
    0.000954339705406193,
    0.000761891003573287,
    0.000598830284134461,
    0.000462281565774996,
    0.000349416569001100,
    0.000257493196406909,
    0.000183887634646636,
    0.000126119913694109,
    0.000081872943140812,
    0.000049005219802397,
    0.000025557561404639,
    0.000009754363726571,
    0.000000000000000000,
    -0.000005128921027786,
    -0.000006894650075208,
    -0.000006411912043391,
    -0.000004663189391103,
    -0.000002514832169553,
    -0.000000733187507994,
    0.000000000000000000,
]
h_d = [
    0.000000000000000000,
    0.000006654468709502,
    0.000029128522936023,
    0.000071630294094485,
    0.000139045364715286,
    0.000237018146420107,
    0.000371990776314115,
    0.000551191427798929,
    0.000782566139698271,
    0.001074650878794300,
    0.001436383452247726,
    0.001876857948081446,
    0.002405027463171737,
    0.003029363833662816,
    0.003757485769150283,
    0.004595769074907365,
    0.005548954406576212,
    0.006619769140808002,
    0.007808580390891126,
    0.009113095905728782,
    0.010528128553079571,
    0.012045438326481696,
    0.013653663385294468,
    0.015338348625262888,
    0.017082076796941639,
    0.018864703378109852,
    0.020663692418049256,
    0.022454546570933227,
    0.024211320690754524,
    0.025907204835505290,
    0.027515159476891312,
    0.029008583268927898,
    0.030361992005490210,
    0.031551686475304340,
    0.032556386852028101,
    0.033357812050676970,
    0.033941184117168982,
    0.034295640137166114,
    0.034414537262454484,
    0.034295640137166114,
    0.033941184117168982,
    0.033357812050676984,
    0.032556386852028101,
    0.031551686475304340,
    0.030361992005490220,
    0.029008583268927898,
    0.027515159476891322,
    0.025907204835505290,
    0.024211320690754531,
    0.022454546570933234,
    0.020663692418049256,
    0.018864703378109866,
    0.017082076796941632,
    0.015338348625262895,
    0.013653663385294473,
    0.012045438326481693,
    0.010528128553079576,
    0.009113095905728785,
    0.007808580390891126,
    0.006619769140808005,
    0.005548954406576217,
    0.004595769074907367,
    0.003757485769150290,
    0.003029363833662813,
    0.002405027463171739,
    0.001876857948081447,
    0.001436383452247725,
    0.001074650878794302,
    0.000782566139698270,
    0.000551191427798929,
    0.000371990776314116,
    0.000237018146420106,
    0.000139045364715286,
    0.000071630294094485,
    0.000029128522936022,
    0.000006654468709502,
    0.000000000000000000,
]

#number of points to average
X_a = int(round(len(t_a)/len(h_a)))
X_b = int(round(len(t_b)/len(h_b)))
X_c = int(round(len(t_c)/len(h_c)))
X_d = int(round(len(t_d)/len(h_d)))

#average points
data_fa, t_fa = weighted_sum(X_a,h_a,data_a,t_a)
data_fb, t_fb = weighted_sum(X_b,h_b,data_b,t_b)
data_fc, t_fc = weighted_sum(X_c,h_c,data_c,t_c)
data_fd, t_fd = weighted_sum(X_d,h_d,data_d,t_d)

#fourier transform
frq_fa, Y_fa = my_fft(data_fa,t_fa)
frq_a, Y_a = my_fft(data_a,t_a)
frq_fb, Y_fb = my_fft(data_fb,t_fb)
frq_b, Y_b = my_fft(data_b,t_b)
frq_fc, Y_fc = my_fft(data_fc,t_fc)
frq_c, Y_c = my_fft(data_c,t_c)
frq_fd, Y_fd = my_fft(data_fd,t_fd)
frq_d, Y_d = my_fft(data_d,t_d)

#plot
plt.figure(0)
plt.loglog(frq_a,abs(Y_a),'k')
plt.loglog(frq_fa,abs(Y_fa),'r')
plt.xlabel('Freq (Hz)')
plt.ylabel('|Y(freq)|')
plt.title("FFT of Signal A: Filter has {:d} coefficients".format(len(h_a)))
plt.legend(['unfiltered','filtered'])
plt.show()
plt.figure(1)
plt.loglog(frq_b,abs(Y_b),'k')
plt.loglog(frq_fb,abs(Y_fb),'r')
plt.xlabel('Freq (Hz)')
plt.ylabel('|Y(freq)|')
plt.title("FFT of Signal B: Filter has {:d} coefficients".format(len(h_b)))
plt.legend(['unfiltered','filtered'])
plt.show()
plt.figure(2)
plt.loglog(frq_c,abs(Y_c),'k')
plt.loglog(frq_fc,abs(Y_fc),'r')
plt.xlabel('Freq (Hz)')
plt.ylabel('|Y(freq)|')
plt.title("FFT of Signal C: Filter has {:d} coefficients".format(len(h_c)))
plt.legend(['unfiltered','filtered'])
plt.show()
plt.figure(3)
plt.loglog(frq_d,abs(Y_d),'k')
plt.loglog(frq_fd,abs(Y_fd),'r')
plt.xlabel('Freq (Hz)')
plt.ylabel('|Y(freq)|')
plt.title("FFT of Signal D: Filter has {:d} coefficients".format(len(h_d)))
plt.legend(['unfiltered','filtered'])
plt.show()


#plot signal
# plt.plot(t_d,data_d,'r')
# plt.plot(t_fd,data_fd,'k')
# plt.xlabel('Time [s]')
# plt.ylabel('Signal')
# plt.title('Signal D')
# plt.show()